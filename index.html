<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tonny Lays | Construction Attendance</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2E8B57;
            --primary-dark: #256F47;
            --secondary: #FF6B35;
            --accent: #00A8E8;
            --success: #4CD964;
            --warning: #FF9500;
            --danger: #FF3B30;
            --dark-bg: #121826;
            --dark-card: #1E293B;
            --dark-border: #334155;
            --text-primary: #F8FAFC;
            --text-secondary: #CBD5E1;
            --text-muted: #94A3B8;
            --gradient-primary: linear-gradient(135deg, #2E8B57 0%, #00A8E8 100%);
            --gradient-secondary: linear-gradient(135deg, #FF6B35 0%, #FF9500 100%);
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-container {
            min-height: 100vh;
            padding-bottom: 2rem;
        }

        /* Header */
        .app-header {
            background: var(--dark-card);
            padding: 1.5rem 1rem;
            box-shadow: var(--shadow);
            border-bottom: 1px solid var(--dark-border);
        }

        .header-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .header-content {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .app-header {
                padding: 1.5rem 2rem;
            }
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            background: var(--gradient-primary);
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .logo-text {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 1.4rem;
            background: linear-gradient(to right, #2E8B57, #00A8E8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .company-name {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: -5px;
        }

        .header-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            align-items: center;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .sync-status.syncing {
            color: var(--accent);
        }

        .sync-status.synced {
            color: var(--success);
        }

        .sync-status.error {
            color: var(--danger);
        }

        .period-selector, .site-selector {
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            padding: 0.7rem 1rem;
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            min-width: 150px;
            width: 100%;
        }

        @media (min-width: 480px) {
            .period-selector, .site-selector {
                width: auto;
            }
        }

        .passkey-display {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }

        @media (min-width: 480px) {
            .passkey-display {
                width: auto;
            }
        }

        /* Stats */
        .stats-section {
            padding: 1.5rem 1rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .stats-section {
                padding: 1.5rem 2rem;
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .stat-card {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .stat-1 .stat-icon { background: linear-gradient(135deg, #2E8B57, #00A8E8); }
        .stat-2 .stat-icon { background: linear-gradient(135deg, #FF6B35, #FF9500); }
        .stat-3 .stat-icon { background: linear-gradient(135deg, #4CD964, #00A8E8); }
        .stat-4 .stat-icon { background: linear-gradient(135deg, #FF9500, #FF6B35); }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-family: 'Montserrat', sans-serif;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Filters Section */
        .filters-section {
            padding: 1rem 1rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .filters-section {
                padding: 1rem 2rem;
            }
        }

        .filters-grid {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        @media (min-width: 768px) {
            .filters-grid {
                flex-direction: row;
                align-items: center;
            }
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .filter-select {
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 10px;
            padding: 0.6rem 1rem;
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            min-width: 150px;
            width: 100%;
        }

        @media (min-width: 480px) {
            .filter-select {
                width: auto;
            }
        }

        .filter-select option {
            background: var(--dark-card);
            color: var(--text-primary);
        }

        .active-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        @media (min-width: 768px) {
            .active-filters {
                margin-top: 0;
                margin-left: auto;
            }
        }

        .filter-chip {
            background: var(--primary);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-chip .remove {
            cursor: pointer;
            opacity: 0.8;
        }

        .filter-chip .remove:hover {
            opacity: 1;
        }

        /* Controls */
        .controls-section {
            padding: 0 1rem 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .controls-section {
                padding: 0 2rem 1.5rem;
            }
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        @media (min-width: 768px) {
            .controls-grid {
                display: flex;
                flex-wrap: wrap;
            }
        }

        .control-btn {
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            padding: 0.8rem 1rem;
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
        }

        .control-btn.primary {
            background: var(--primary);
            border-color: var(--primary);
        }

        .control-btn.success {
            background: var(--success);
            border-color: var(--success);
        }

        .control-btn.danger {
            background: var(--danger);
            border-color: var(--danger);
        }

        .control-btn.cloud {
            background: var(--accent);
            border-color: var(--accent);
        }

        /* Main Content */
        .main-content {
            padding: 0 1rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .main-content {
                padding: 0 2rem;
            }
        }

        .content-header {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (min-width: 768px) {
            .content-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .section-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .search-box {
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            padding: 0.8rem 1rem;
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            width: 100%;
        }

        @media (min-width: 768px) {
            .search-box {
                width: 300px;
            }
        }

        /* Employee Grid */
        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        @media (max-width: 480px) {
            .employee-grid {
                grid-template-columns: 1fr;
            }
        }

        .employee-card {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .employee-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .employee-card.expanded {
            grid-column: 1 / -1;
        }

        .employee-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--gradient-primary);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .employee-info h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .days-badge {
            background: var(--gradient-secondary);
            color: white;
            font-size: 0.8rem;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-weight: 600;
        }

        .employee-meta {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .employee-role {
            color: var(--text-secondary);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .employee-rate {
            color: var(--accent);
            font-weight: 600;
            font-size: 0.9rem;
            display: none; /* Hidden by default */
        }

        .employee-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--dark-border);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        .action-btn.delete {
            background: rgba(255, 59, 48, 0.2);
            border-color: var(--danger);
            color: var(--danger);
        }

        .action-btn.delete:hover {
            background: var(--danger);
            color: white;
        }

        /* Attendance Matrix */
        .attendance-section {
            margin-top: 1.5rem;
        }

        .section-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 0.8rem;
            display: block;
        }

        .attendance-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
            gap: 0.5rem;
        }

        @media (min-width: 768px) {
            .attendance-matrix {
                grid-template-columns: repeat(7, 1fr);
            }
        }

        .day-cell {
            aspect-ratio: 1;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--dark-border);
            transition: all 0.3s ease;
            position: relative;
        }

        .day-cell.present {
            background: rgba(76, 217, 100, 0.2);
            border-color: var(--success);
            color: var(--success);
        }

        .day-cell.absent {
            background: rgba(255, 59, 48, 0.2);
            border-color: var(--danger);
            color: var(--danger);
        }

        .day-cell.weekend {
            background: rgba(255, 149, 0, 0.1);
            border-color: var(--warning);
            color: var(--warning);
        }

        .day-cell.weekend.present {
            background: rgba(76, 217, 100, 0.2);
            border-color: var(--success);
            color: var(--success);
        }

        .day-cell.weekend.absent {
            background: rgba(255, 59, 48, 0.2);
            border-color: var(--danger);
            color: var(--danger);
        }

        .day-cell.future {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .day-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 0.2rem;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 2px;
        }

        .present .status-indicator { background: var(--success); }
        .absent .status-indicator { background: var(--danger); }
        .weekend:not(.present):not(.absent) .status-indicator { background: var(--warning); }

        /* FAB */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .fab:hover {
            transform: scale(1.1);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-content {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 1.5rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--dark-border);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            padding: 0.9rem 1rem;
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-direction: column;
        }

        @media (min-width: 480px) {
            .form-actions {
                flex-direction: row;
            }
        }

        .btn {
            flex: 1;
            padding: 0.9rem 1.5rem;
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
            border: 1px solid var(--dark-border);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 2rem;
            right: 1rem;
            left: 1rem;
            background: var(--dark-card);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 1001;
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.4s ease;
        }

        @media (min-width: 768px) {
            .toast {
                left: auto;
                right: 2rem;
                max-width: 400px;
            }
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: var(--primary);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .toast-message {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Cloud Setup Modal */
        .cloud-setup {
            background: rgba(0, 168, 232, 0.1);
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .cloud-setup h4 {
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .cloud-setup p {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        /* Worker Details Panel */
        .worker-details {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--dark-border);
            display: none;
        }

        .worker-details.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .detail-value {
            font-size: 1rem;
            font-weight: 500;
        }

        .earnings-breakdown {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .breakdown-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        /* All Users View */
        .all-users-section {
            padding: 1rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .users-table th, .users-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid var(--dark-border);
        }

        .users-table th {
            background: rgba(255, 255, 255, 0.05);
            font-weight: 600;
        }

        .users-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--dark-border);
            margin-bottom: 1.5rem;
        }

        .tab {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Attendance Summary */
        .attendance-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .summary-card {
            background: var(--dark-card);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid var(--dark-border);
        }

        .summary-title {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* Setup Instructions */
        .setup-instructions {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid var(--accent);
        }

        .setup-instructions h3 {
            color: var(--accent);
            margin-bottom: 1rem;
        }

        .setup-instructions ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .setup-instructions li {
            margin-bottom: 0.5rem;
        }

        .setup-instructions code {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-hard-hat"></i>
                    </div>
                    <div>
                        <div class="logo-text">Tonny Lays</div>
                        <div class="company-name">Construction Attendance Pro</div>
                    </div>
                </div>
                <div class="header-controls">
                    <div class="sync-status" id="syncStatus">
                        <i class="fas fa-cloud"></i>
                        <span>Ready</span>
                    </div>
                    <select class="period-selector" id="periodSelector">
                        <option value="current">Current Fortnight</option>
                    </select>
                    <select class="site-selector" id="siteSelector">
                        <option value="">Loading sites...</option>
                    </select>
                    <div class="passkey-display">
                        <i class="fas fa-key"></i>
                        <span id="passkeyDisplay">TL-MAIN-2024-01</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="attendance">Attendance</div>
            <div class="tab" data-tab="all-users">All Users</div>
            <div class="tab" data-tab="reports">Reports</div>
            <div class="tab" data-tab="setup">Setup</div>
        </div>

        <!-- Attendance Tab -->
        <div class="tab-content active" id="attendance-tab">
            <!-- Stats -->
            <section class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card stat-1">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="totalWorkers">0</div>
                        <div class="stat-label">Total Workers</div>
                    </div>
                    <div class="stat-card stat-2">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-value" id="presentToday">0</div>
                        <div class="stat-label">Present Today</div>
                    </div>
                    <div class="stat-card stat-3">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-value" id="attendanceRate">0%</div>
                        <div class="stat-label">Attendance Rate</div>
                    </div>
                    <div class="stat-card stat-4">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-value" id="totalPay">R 0</div>
                        <div class="stat-label">Fortnight Payroll</div>
                    </div>
                </div>
            </section>

            <!-- Filters -->
            <section class="filters-section">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Filter by Role</label>
                        <select class="filter-select" id="roleFilter">
                            <option value="all">All Roles</option>
                            <option value="Bricklayer">Bricklayers</option>
                            <option value="Labourer">Labourers</option>
                            <option value="Plasterer">Plasterers</option>
                            <option value="Plaster Labourer">Plaster Labourers</option>
                            <option value="Plaster Operator">Plaster Operators</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Attendance Status</label>
                        <select class="filter-select" id="attendanceFilter">
                            <option value="all">All Workers</option>
                            <option value="present">Present Today</option>
                            <option value="absent">Absent Today</option>
                            <option value="not-marked">Not Marked Today</option>
                        </select>
                    </div>

                    <div class="active-filters" id="activeFilters">
                        <!-- Active filters will appear here -->
                    </div>
                </div>
            </section>

            <!-- Controls -->
            <section class="controls-section">
                <div class="controls-grid">
                    <button class="control-btn primary" onclick="markAllPresentToday()">
                        <i class="fas fa-check-circle"></i> Mark All Present
                    </button>
                    <button class="control-btn" onclick="exportToExcel()">
                        <i class="fas fa-file-excel"></i> Export Excel
                    </button>
                    <button class="control-btn" onclick="showAddWorkerModal()">
                        <i class="fas fa-user-plus"></i> Add Worker
                    </button>
                    <button class="control-btn" onclick="showAddSiteModal()">
                        <i class="fas fa-map-marker-alt"></i> Add Site
                    </button>
                    <button class="control-btn cloud" onclick="syncToCloud()">
                        <i class="fas fa-cloud-upload-alt"></i> Sync Cloud
                    </button>
                    <button class="control-btn success" onclick="saveData()">
                        <i class="fas fa-save"></i> Save Local
                    </button>
                    <button class="control-btn danger" onclick="clearAllAttendance()">
                        <i class="fas fa-broom"></i> Clear All
                    </button>
                </div>
            </section>

            <!-- Main Content -->
            <main class="main-content">
                <div class="content-header">
                    <h2 class="section-title">Worker Attendance</h2>
                    <input type="text" class="search-box" id="searchInput" placeholder="Search workers...">
                </div>
                <div class="employee-grid" id="employeeGrid">
                    <!-- Dynamic content -->
                </div>
            </main>
        </div>

        <!-- All Users Tab -->
        <div class="tab-content" id="all-users-tab">
            <div class="all-users-section">
                <div class="content-header">
                    <h2 class="section-title">All Workers</h2>
                    <button class="control-btn primary" onclick="showAddWorkerModal()">
                        <i class="fas fa-user-plus"></i> Add Worker
                    </button>
                </div>
                <table class="users-table" id="usersTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Role</th>
                            <th>Rate</th>
                            <th>Site</th>
                            <th>Bank</th>
                            <th>Account No.</th>
                            <th>Days Worked</th>
                            <th>Total Pay</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Reports Tab -->
        <div class="tab-content" id="reports-tab">
            <div class="all-users-section">
                <div class="content-header">
                    <h2 class="section-title">Reports & Analytics</h2>
                    <div>
                        <button class="control-btn" onclick="exportDailyAttendancePDF()">
                            <i class="fas fa-file-pdf"></i> Export Daily PDF
                        </button>
                        <button class="control-btn primary" onclick="generatePayrollReport()">
                            <i class="fas fa-file-pdf"></i> Generate Payroll Report
                        </button>
                    </div>
                </div>
                <div class="attendance-summary">
                    <div class="summary-card">
                        <div class="summary-title">Total Workers</div>
                        <div class="summary-value" id="reportTotalWorkers">0</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">Average Attendance Rate</div>
                        <div class="summary-value" id="reportAttendanceRate">0%</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">Total Payroll</div>
                        <div class="summary-value" id="reportTotalPay">R 0</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">Days in Period</div>
                        <div class="summary-value" id="reportDaysInPeriod">0</div>
                    </div>
                </div>
                <div class="users-table-container" style="margin-top: 2rem;">
                    <h3 style="margin-bottom: 1rem;">Attendance Summary</h3>
                    <table class="users-table" id="reportsTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Days Worked</th>
                                <th>Total Pay</th>
                                <th>Attendance Rate</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Setup Tab -->
        <div class="tab-content" id="setup-tab">
            <div class="all-users-section">
                <h2 class="section-title">System Setup</h2>
                
                <div class="setup-instructions">
                    <h3>Data Backup Instructions</h3>
                    <p>Since the Google Sheets API is not working reliably, use these methods to backup your data:</p>
                    <ol>
                        <li><strong>Export Daily PDFs:</strong> Use the "Export Daily PDF" button to save daily attendance records</li>
                        <li><strong>Export Excel:</strong> Use the "Export Excel" button to save complete worker data with bank details</li>
                        <li><strong>Save Local:</strong> Use the "Save Local" button to save data in your browser</li>
                    </ol>
                    <p>For best results, export both daily PDFs and the complete Excel file at the end of each fortnight.</p>
                </div>

                <div class="form-group">
                    <label class="form-label">Default Site</label>
                    <input type="text" class="form-input" id="defaultSite" value="Paarl">
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                    <button class="btn btn-secondary" onclick="backupData()">Backup All Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FAB -->
    <div class="fab" onclick="showAddWorkerModal()">
        <i class="fas fa-plus"></i>
    </div>

    <!-- Add Worker Modal -->
    <div class="modal" id="addWorkerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Worker</h3>
                <button class="close-modal" onclick="closeModal('addWorkerModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-input" id="workerName" placeholder="Enter full name">
            </div>
            <div class="form-group">
                <label class="form-label">Role</label>
                <select class="form-input" id="workerRole">
                    <option value="Bricklayer">Bricklayer</option>
                    <option value="Labourer">Labourer</option>
                    <option value="Plasterer">Plasterer</option>
                    <option value="Plaster Labourer">Plaster Labourer</option>
                    <option value="Plaster Operator">Plaster Operator</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Daily Rate (R)</label>
                <input type="number" class="form-input" id="workerRate" placeholder="Enter daily rate">
            </div>
            <div class="form-group">
                <label class="form-label">Bank Name</label>
                <input type="text" class="form-input" id="workerBank" placeholder="e.g., ABSA Bank">
            </div>
            <div class="form-group">
                <label class="form-label">Account Number</label>
                <input type="text" class="form-input" id="workerAccount" placeholder="e.g., 1002345">
            </div>
            <div class="form-group">
                <label class="form-label">Phone Number (Optional)</label>
                <input type="text" class="form-input" id="workerPhone" placeholder="e.g., 0712345678">
            </div>
            <div class="form-group">
                <label class="form-label">Site</label>
                <select class="form-input" id="workerSite">
                    <option value="Paarl">Paarl</option>
                </select>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeModal('addWorkerModal')">Cancel</button>
                <button class="btn btn-primary" onclick="addWorker()">Add Worker</button>
            </div>
        </div>
    </div>

    <!-- Add Site Modal -->
    <div class="modal" id="addSiteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Site</h3>
                <button class="close-modal" onclick="closeModal('addSiteModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Site Name</label>
                <input type="text" class="form-input" id="siteName" placeholder="Enter site name">
            </div>
            <div class="form-group">
                <label class="form-label">Site Code</label>
                <input type="text" class="form-input" id="siteCode" placeholder="Enter site code">
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeModal('addSiteModal')">Cancel</button>
                <button class="btn btn-primary" onclick="addSite()">Add Site</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <i class="fas fa-check"></i>
        </div>
        <div class="toast-content">
            <div class="toast-title">Success</div>
            <div class="toast-message">Operation completed successfully</div>
        </div>
    </div>

    <script>
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // Global variables
        let workers = [];
        let sites = [];
        let currentPeriod = 'current';
        let selectedSite = 'Paarl';
        let searchTerm = '';
        let roleFilter = 'all';
        let attendanceFilter = 'all';

        // Role order for sorting
        const roleOrder = {
            'Bricklayer': 1,
            'Plasterer': 2,
            'Plaster Operator': 3,
            'Plaster Labourer': 4,
            'Labourer': 5
        };

        // Initialize the application
        function initializeApp() {
            loadData();
            setupEventListeners();
            renderWorkers();
            updateStats();
            setupTabs();
            updatePeriodSelector();
        }

        // Set up event listeners
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', function(e) {
                searchTerm = e.target.value.toLowerCase();
                renderWorkers();
            });

            document.getElementById('roleFilter').addEventListener('change', function(e) {
                roleFilter = e.target.value;
                renderWorkers();
            });

            document.getElementById('attendanceFilter').addEventListener('change', function(e) {
                attendanceFilter = e.target.value;
                renderWorkers();
            });

            document.getElementById('siteSelector').addEventListener('change', function(e) {
                selectedSite = e.target.value;
                renderWorkers();
                updateStats();
            });

            document.getElementById('periodSelector').addEventListener('change', function(e) {
                currentPeriod = e.target.value;
                renderWorkers();
                updateStats();
            });
        }

        // Set up tab navigation
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // Refresh content if needed
                    if (tabId === 'all-users') {
                        renderAllUsersTable();
                    } else if (tabId === 'reports') {
                        renderReports();
                    }
                });
            });
        }

        // Update period selector with current and future fortnights
        function updatePeriodSelector() {
            const periodSelector = document.getElementById('periodSelector');
            periodSelector.innerHTML = '';
            
            // Add current fortnight
            const currentFortnight = getCurrentFortnight();
            const currentOption = document.createElement('option');
            currentOption.value = 'current';
            currentOption.textContent = `Current: ${formatDate(currentFortnight.start)} - ${formatDate(currentFortnight.end)}`;
            periodSelector.appendChild(currentOption);
            
            // Add next fortnight
            const nextFortnight = getNextFortnight();
            const nextOption = document.createElement('option');
            nextOption.value = 'next';
            nextOption.textContent = `Next: ${formatDate(nextFortnight.start)} - ${formatDate(nextFortnight.end)}`;
            periodSelector.appendChild(nextOption);
        }

        // Get current fortnight (8 Oct 2025 to 21 Oct 2025)
        function getCurrentFortnight() {
            // For testing, we'll use the fixed dates you specified
            // In production, this would calculate based on current date
            const startDate = new Date('2025-10-08');
            const endDate = new Date('2025-10-21');
            
            return {
                start: startDate,
                end: endDate,
                days: getDaysInRange(startDate, endDate)
            };
        }

        // Get next fortnight (22 Oct 2025 to 4 Nov 2025)
        function getNextFortnight() {
            const currentFortnight = getCurrentFortnight();
            const startDate = new Date(currentFortnight.end);
            startDate.setDate(startDate.getDate() + 1);
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 13);
            
            return {
                start: startDate,
                end: endDate,
                days: getDaysInRange(startDate, endDate)
            };
        }

        // Get all days in a date range
        function getDaysInRange(startDate, endDate) {
            const days = [];
            const currentDate = new Date(startDate);
            
            while (currentDate <= endDate) {
                days.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return days;
        }

        // Get the current fortnight based on selected period
        function getSelectedFortnight() {
            if (currentPeriod === 'current') {
                return getCurrentFortnight();
            } else {
                return getNextFortnight();
            }
        }

        // Format date for display (DD/MM/YYYY)
        function formatDate(date) {
            if (!date) return '';
            
            const d = new Date(date);
            const day = d.getDate().toString().padStart(2, '0');
            const month = (d.getMonth() + 1).toString().padStart(2, '0');
            const year = d.getFullYear();
            
            return `${day}/${month}/${year}`;
        }

        // Load data from localStorage
        function loadData() {
            // Load workers
            const savedWorkers = localStorage.getItem('tonnyLaysWorkers');
            if (savedWorkers) {
                workers = JSON.parse(savedWorkers);
            } else {
                // Initialize with default workers
                initializeDefaultWorkers();
            }

            // Load sites
            const savedSites = localStorage.getItem('tonnyLaysSites');
            if (savedSites) {
                sites = JSON.parse(savedSites);
            } else {
                // Initialize with default sites
                sites = [{ id: 'paarl', name: 'Paarl', code: 'PRL' }];
                saveSites();
            }

            // Load settings
            const savedSettings = localStorage.getItem('tonnyLaysSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                selectedSite = settings.defaultSite || selectedSite;
            }

            // Update site selector
            updateSiteSelector();
        }

        // Initialize with default workers
        function initializeDefaultWorkers() {
            workers = [
                // Bricklayers (R400)
                { id: 'eric', name: 'Eric', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002345', phone: '', attendance: {} },
                { id: 'gipson', name: 'Gipson', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002346', phone: '', attendance: {} },
                { id: 'milamulo', name: 'Milamulo', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002347', phone: '', attendance: {} },
                { id: 'justice', name: 'Justice', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002348', phone: '', attendance: {} },
                { id: 'lucas-mathabela', name: 'Lucas Mathabela', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002349', phone: '', attendance: {} },
                { id: 'tholang-lerothothi', name: 'Tholang Lerothothi', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002350', phone: '', attendance: {} },
                { id: 'bekezela', name: 'Bekezela', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002351', phone: '', attendance: {} },
                { id: 'muvi', name: 'Muvi', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002352', phone: '', attendance: {} },
                { id: 'fusi', name: 'Fusi', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002353', phone: '', attendance: {} },
                { id: 'thokozani', name: 'Thokozani', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002354', phone: '', attendance: {} },
                { id: 'arson', name: 'Arson', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002355', phone: '', attendance: {} },
                { id: 'moses', name: 'Moses', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002356', phone: '', attendance: {} },
                { id: 'sipho', name: 'Sipho', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002357', phone: '', attendance: {} },
                { id: 'nkosinathi', name: 'Nkosinathi', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002358', phone: '', attendance: {} },
                { id: 'xolani-k', name: 'Xolani K', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002359', phone: '', attendance: {} },
                { id: 'rendani', name: 'Rendani', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002360', phone: '', attendance: {} },
                { id: 'alex', name: 'Alex', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002361', phone: '', attendance: {} },
                { id: 'lawrence', name: 'Lawrence', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002362', phone: '', attendance: {} },
                { id: 'albert', name: 'Albert', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002363', phone: '', attendance: {} },
                { id: 'solomon', name: 'Solomon', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002364', phone: '', attendance: {} },
                { id: 'silva', name: 'Silva', role: 'Bricklayer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '1002365', phone: '', attendance: {} },

                // Labourers (R230)
                { id: 'eddy', name: 'Eddy', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002345', phone: '', attendance: {} },
                { id: 'steward', name: 'Steward', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002346', phone: '', attendance: {} },
                { id: 'siya', name: 'Siya', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002347', phone: '', attendance: {} },
                { id: 'innocent', name: 'Innocent', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002348', phone: '', attendance: {} },
                { id: 'max', name: 'Max', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002349', phone: '', attendance: {} },
                { id: 'nkosinathi-labourer', name: 'Nkosinathi', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002350', phone: '', attendance: {} },
                { id: 'carlito', name: 'Carlito', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002351', phone: '', attendance: {} },
                { id: 'sethu', name: 'Sethu', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002352', phone: '', attendance: {} },
                { id: 'john', name: 'John', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002353', phone: '', attendance: {} },
                { id: 'ubuntu', name: 'Ubuntu', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002354', phone: '', attendance: {} },
                { id: 'masupa', name: 'Masupa', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002355', phone: '', attendance: {} },
                { id: 'otho', name: 'Otho', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002356', phone: '', attendance: {} },
                { id: 'boy', name: 'Boy', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002357', phone: '', attendance: {} },
                { id: 'nelson-sambo', name: 'Nelson Sambo', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002358', phone: '', attendance: {} },
                { id: 'maxwell', name: 'Maxwell', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002359', phone: '', attendance: {} },
                { id: 'simphiwe-n', name: 'Simphiwe N', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002360', phone: '', attendance: {} },
                { id: 'buncoko', name: 'Buncoko', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002361', phone: '', attendance: {} },
                { id: 'mandinhu', name: 'Mandinhu', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002362', phone: '', attendance: {} },
                { id: 'aphiwe-n', name: 'Aphiwe N', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002363', phone: '', attendance: {} },
                { id: 'mahlatse', name: 'Mahlatse', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002364', phone: '', attendance: {} },
                { id: 'thulani', name: 'Thulani', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002365', phone: '', attendance: {} },
                { id: 'dumisang', name: 'Dumisang', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002366', phone: '', attendance: {} },
                { id: 'lucas-likumba', name: 'Lucas Likumba', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002367', phone: '', attendance: {} },
                { id: 'lloyd', name: 'Lloyd', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002368', phone: '', attendance: {} },
                { id: 'xolandi-k', name: 'Xolandi K', role: 'Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '2002369', phone: '', attendance: {} },

                // Plasterers
                { id: 'lucky-chauke', name: 'Lucky Chauke', role: 'Plasterer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '3002345', phone: '', attendance: {} },
                { id: 'manuel', name: 'Manuel', role: 'Plasterer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '3002346', phone: '', attendance: {} },
                { id: 'tito', name: 'Tito', role: 'Plasterer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '3002347', phone: '', attendance: {} },
                { id: 'mausse', name: 'Mausse', role: 'Plasterer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '3002348', phone: '', attendance: {} },
                { id: 'sam', name: 'Sam', role: 'Plasterer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '3002349', phone: '', attendance: {} },
                { id: 'musani', name: 'Musani', role: 'Plasterer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '3002350', phone: '', attendance: {} },
                { id: 'zunco', name: 'Zunco', role: 'Plasterer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '3002351', phone: '', attendance: {} },
                { id: 'michael', name: 'Michael', role: 'Plasterer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '3002352', phone: '', attendance: {} },
                { id: 'alcido', name: 'Alcido', role: 'Plasterer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '3002353', phone: '', attendance: {} },
                { id: 'freddy', name: 'Freddy', role: 'Plasterer', rate: 400, site: 'Paarl', bank: 'ABSA Bank', account: '3002354', phone: '', attendance: {} },

                // Plaster Labourers
                { id: 'luvo', name: 'Luvo', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002345', phone: '', attendance: {} },
                { id: 'aviwe', name: 'Aviwe', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002346', phone: '', attendance: {} },
                { id: 'baxolele', name: 'Baxolele', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002347', phone: '', attendance: {} },
                { id: 'masupa-pl', name: 'Masupa PL', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002348', phone: '', attendance: {} },
                { id: 'alexis', name: 'Alexis', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002349', phone: '', attendance: {} },
                { id: 'buncoko-pl', name: 'Buncoko PL', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002350', phone: '', attendance: {} },
                { id: 'carlito-pl', name: 'Carlito PL', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002351', phone: '', attendance: {} },
                { id: 'pinto', name: 'Pinto', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002352', phone: '', attendance: {} },
                { id: 'tebogo', name: 'Tebogo', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002353', phone: '', attendance: {} },
                { id: 'paul-ibrahim', name: 'Paul Ibrahim', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002354', phone: '', attendance: {} },
                { id: 'xolani-ndlovu', name: 'Xolani Ndlovu', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002355', phone: '', attendance: {} },
                { id: 'nason', name: 'Nason', role: 'Plaster Labourer', rate: 230, site: 'Paarl', bank: 'ABSA Bank', account: '4002356', phone: '', attendance: {} },

                // Plaster Operators
                { id: 'messiah', name: 'Messiah', role: 'Plaster Operator', rate: 450, site: 'Paarl', bank: 'ABSA Bank', account: '5002345', phone: '', attendance: {} },
                { id: 'thembela', name: 'Thembela', role: 'Plaster Operator', rate: 450, site: 'Paarl', bank: 'ABSA Bank', account: '5002346', phone: '', attendance: {} },
                { id: 'mathe', name: 'Mathe', role: 'Plaster Operator', rate: 450, site: 'Paarl', bank: 'ABSA Bank', account: '5002347', phone: '', attendance: {} },
                { id: 'moses-plaster', name: 'Moses', role: 'Plaster Operator', rate: 450, site: 'Paarl', bank: 'ABSA Bank', account: '5002348', phone: '', attendance: {} },
                { id: 'nelson', name: 'Nelson', role: 'Plaster Operator', rate: 450, site: 'Paarl', bank: 'ABSA Bank', account: '5002349', phone: '', attendance: {} },
                { id: 'nelio', name: 'Nelio', role: 'Plaster Operator', rate: 450, site: 'Paarl', bank: 'ABSA Bank', account: '5002350', phone: '', attendance: {} }
            ];

            saveWorkers();
        }

        // Save workers to localStorage
        function saveWorkers() {
            localStorage.setItem('tonnyLaysWorkers', JSON.stringify(workers));
        }

        // Save sites to localStorage
        function saveSites() {
            localStorage.setItem('tonnyLaysSites', JSON.stringify(sites));
        }

        // Save settings to localStorage
        function saveSettings() {
            const settings = {
                defaultSite: document.getElementById('defaultSite').value
            };
            localStorage.setItem('tonnyLaysSettings', JSON.stringify(settings));
            showToast('Settings saved successfully', 'success');
        }

        // Update site selector dropdown
        function updateSiteSelector() {
            const siteSelector = document.getElementById('siteSelector');
            siteSelector.innerHTML = '';
            
            sites.forEach(site => {
                const option = document.createElement('option');
                option.value = site.name;
                option.textContent = site.name;
                if (site.name === selectedSite) {
                    option.selected = true;
                }
                siteSelector.appendChild(option);
            });
        }

        // Sort workers by role (Bricklayers first, then Labourers, etc.)
        function sortWorkersByRole(workersArray) {
            return workersArray.sort((a, b) => {
                const roleOrderA = roleOrder[a.role] || 999;
                const roleOrderB = roleOrder[b.role] || 999;
                
                if (roleOrderA !== roleOrderB) {
                    return roleOrderA - roleOrderB;
                }
                
                // If same role, sort by name
                return a.name.localeCompare(b.name);
            });
        }

        // Render workers in the grid
        function renderWorkers() {
            const employeeGrid = document.getElementById('employeeGrid');
            employeeGrid.innerHTML = '';

            // Filter workers based on search term, role filter, attendance filter, and site
            const filteredWorkers = workers.filter(worker => {
                const matchesSearch = worker.name.toLowerCase().includes(searchTerm);
                const matchesRole = roleFilter === 'all' || worker.role === roleFilter;
                const matchesSite = selectedSite === '' || worker.site === selectedSite;
                
                // Check attendance filter
                const today = getTodayDate();
                let matchesAttendance = true;
                if (attendanceFilter === 'present') {
                    matchesAttendance = worker.attendance[today] === 'present';
                } else if (attendanceFilter === 'absent') {
                    matchesAttendance = worker.attendance[today] === 'absent';
                } else if (attendanceFilter === 'not-marked') {
                    matchesAttendance = !worker.attendance[today];
                }
                
                return matchesSearch && matchesRole && matchesAttendance && matchesSite;
            });

            // Sort workers by role
            const sortedWorkers = sortWorkersByRole(filteredWorkers);

            // Create worker cards
            sortedWorkers.forEach(worker => {
                const card = createWorkerCard(worker);
                employeeGrid.appendChild(card);
            });

            // Update active filters display
            updateActiveFilters();
        }

        // Create a worker card element
        function createWorkerCard(worker) {
            const card = document.createElement('div');
            card.className = 'employee-card';
            card.setAttribute('data-worker-id', worker.id);

            const daysWorked = calculateDaysWorked(worker);
            const totalPay = daysWorked * worker.rate;

            card.innerHTML = `
                <div class="card-header">
                    <div class="employee-info">
                        <h3>${worker.name} <span class="days-badge">${daysWorked} days</span></h3>
                        <div class="employee-meta">
                            <div class="employee-role">
                                <i class="fas fa-hard-hat"></i> ${worker.role}
                            </div>
                            <div class="employee-rate">
                                R ${worker.rate}/day
                            </div>
                        </div>
                    </div>
                    <div class="employee-actions">
                        <div class="action-btn" onclick="editWorker('${worker.id}')">
                            <i class="fas fa-edit"></i>
                        </div>
                        <div class="action-btn delete" onclick="deleteWorker('${worker.id}')">
                            <i class="fas fa-trash"></i>
                        </div>
                    </div>
                </div>
                <div class="attendance-section">
                    <span class="section-label">${currentPeriod === 'current' ? 'Current' : 'Next'} Fortnight</span>
                    <div class="attendance-matrix">
                        ${generateAttendanceMatrix(worker)}
                    </div>
                </div>
                <div class="worker-details" id="details-${worker.id}">
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Days Worked</span>
                            <span class="detail-value">${daysWorked}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Daily Rate</span>
                            <span class="detail-value">R ${worker.rate}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Total Pay</span>
                            <span class="detail-value">R ${totalPay}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Site</span>
                            <span class="detail-value">${worker.site}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Bank</span>
                            <span class="detail-value">${worker.bank || 'Not specified'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Account No.</span>
                            <span class="detail-value">${worker.account || 'Not specified'}</span>
                        </div>
                    </div>
                    <div class="earnings-breakdown">
                        <div class="breakdown-title">Earnings Breakdown</div>
                        <div class="breakdown-item">
                            <span>Days Worked:</span>
                            <span>${daysWorked}</span>
                        </div>
                        <div class="breakdown-item">
                            <span>Daily Rate:</span>
                            <span>R ${worker.rate}</span>
                        </div>
                        <div class="breakdown-item" style="font-weight: 600; border-top: 1px solid var(--dark-border); padding-top: 0.5rem;">
                            <span>Total:</span>
                            <span>R ${totalPay}</span>
                        </div>
                    </div>
                </div>
            `;

            // Add click event to toggle details
            card.addEventListener('click', function(e) {
                // Don't toggle if user clicked on action buttons
                if (!e.target.closest('.employee-actions')) {
                    const details = document.getElementById(`details-${worker.id}`);
                    details.classList.toggle('show');
                }
            });

            return card;
        }

        // Generate attendance matrix for a worker
        function generateAttendanceMatrix(worker) {
            const fortnight = getSelectedFortnight();
            const today = new Date();
            let matrixHTML = '';

            fortnight.days.forEach(day => {
                const dateObj = new Date(day);
                const dayOfWeek = dateObj.getDay();
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                const isToday = isSameDay(dateObj, today);
                const isFuture = dateObj > today;
                const dateKey = formatDateForStorage(dateObj);
                const attendanceStatus = worker.attendance[dateKey] || '';

                let cellClass = 'day-cell';
                if (isWeekend) cellClass += ' weekend';
                if (isFuture) cellClass += ' future';
                if (attendanceStatus === 'present') cellClass += ' present';
                if (attendanceStatus === 'absent') cellClass += ' absent';

                matrixHTML += `
                    <div class="${cellClass}" data-date="${dateKey}" onclick="toggleWorkerAttendance('${worker.id}', '${dateKey}')">
                        <div class="day-label">${formatDateForDisplay(dateObj)}</div>
                        <div class="status-indicator"></div>
                    </div>
                `;
            });

            return matrixHTML;
        }

        // Format date for storage (YYYY-MM-DD)
        function formatDateForStorage(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = (d.getMonth() + 1).toString().padStart(2, '0');
            const day = d.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Get today's date in YYYY-MM-DD format
        function getTodayDate() {
            const today = new Date();
            return formatDateForStorage(today);
        }

        // Format date for display (e.g., "Mon 15")
        function formatDateForDisplay(date) {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const dayName = days[date.getDay()];
            const dayNumber = date.getDate();
            return `${dayName} ${dayNumber}`;
        }

        // Check if two dates are the same day
        function isSameDay(date1, date2) {
            return formatDateForStorage(date1) === formatDateForStorage(date2);
        }

        // Calculate days worked for a worker in the current fortnight
        function calculateDaysWorked(worker) {
            const fortnight = getSelectedFortnight();
            let daysWorked = 0;
            
            fortnight.days.forEach(day => {
                const dateKey = formatDateForStorage(day);
                if (worker.attendance[dateKey] === 'present') {
                    daysWorked++;
                }
            });
            
            return daysWorked;
        }

        // Toggle attendance for a worker on a specific date
        function toggleWorkerAttendance(workerId, date) {
            const worker = workers.find(w => w.id === workerId);
            if (!worker) return;
            
            const dateObj = new Date(date);
            const today = new Date();
            
            // Don't allow marking future dates
            if (dateObj > today) {
                showToast('Cannot mark attendance for future dates', 'error');
                return;
            }
            
            // Toggle attendance status
            if (worker.attendance[date] === 'present') {
                worker.attendance[date] = 'absent';
            } else if (worker.attendance[date] === 'absent') {
                delete worker.attendance[date];
            } else {
                worker.attendance[date] = 'present';
            }
            
            saveWorkers();
            renderWorkers();
            updateStats();
            showToast(`Attendance updated for ${worker.name}`, 'success');
        }

        // Toggle today's attendance for a worker
        function toggleAttendance(workerId) {
            const today = getTodayDate();
            toggleWorkerAttendance(workerId, today);
        }

        // Mark all workers as present today
        function markAllPresentToday() {
            const today = getTodayDate();
            const siteWorkers = workers.filter(worker => selectedSite === '' || worker.site === selectedSite);
            
            siteWorkers.forEach(worker => {
                worker.attendance[today] = 'present';
            });
            
            saveWorkers();
            renderWorkers();
            updateStats();
            showToast(`All workers marked as present for today`, 'success');
        }

        // Update statistics
        function updateStats() {
            const siteWorkers = workers.filter(worker => selectedSite === '' || worker.site === selectedSite);
            const totalWorkers = siteWorkers.length;
            
            const today = getTodayDate();
            const presentToday = siteWorkers.filter(worker => worker.attendance[today] === 'present').length;
            
            // Calculate total days worked and payroll for the current fortnight
            let totalDaysWorked = 0;
            let totalPay = 0;
            
            siteWorkers.forEach(worker => {
                const daysWorked = calculateDaysWorked(worker);
                totalDaysWorked += daysWorked;
                totalPay += daysWorked * worker.rate;
            });
            
            // Calculate attendance rate
            const fortnight = getSelectedFortnight();
            const totalPossibleDays = totalWorkers * fortnight.days.length;
            const attendanceRate = totalPossibleDays > 0 ? Math.round((totalDaysWorked / totalPossibleDays) * 100) : 0;
            
            // Update DOM elements
            document.getElementById('totalWorkers').textContent = totalWorkers;
            document.getElementById('presentToday').textContent = presentToday;
            document.getElementById('attendanceRate').textContent = `${attendanceRate}%`;
            document.getElementById('totalPay').textContent = `R ${totalPay.toLocaleString()}`;
        }

        // Update active filters display
        function updateActiveFilters() {
            const activeFilters = document.getElementById('activeFilters');
            activeFilters.innerHTML = '';
            
            if (roleFilter !== 'all') {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                chip.innerHTML = `
                    Role: ${roleFilter}
                    <span class="remove" onclick="clearFilter('role')">&times;</span>
                `;
                activeFilters.appendChild(chip);
            }
            
            if (attendanceFilter !== 'all') {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                chip.innerHTML = `
                    Status: ${attendanceFilter}
                    <span class="remove" onclick="clearFilter('attendance')">&times;</span>
                `;
                activeFilters.appendChild(chip);
            }
            
            if (selectedSite !== '') {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                chip.innerHTML = `
                    Site: ${selectedSite}
                    <span class="remove" onclick="clearFilter('site')">&times;</span>
                `;
                activeFilters.appendChild(chip);
            }
        }

        // Clear a specific filter
        function clearFilter(type) {
            if (type === 'role') {
                document.getElementById('roleFilter').value = 'all';
                roleFilter = 'all';
            } else if (type === 'attendance') {
                document.getElementById('attendanceFilter').value = 'all';
                attendanceFilter = 'all';
            } else if (type === 'site') {
                document.getElementById('siteSelector').value = '';
                selectedSite = '';
            }
            
            renderWorkers();
            updateStats();
        }

        // Show add worker modal
        function showAddWorkerModal() {
            document.getElementById('addWorkerModal').style.display = 'flex';
        }

        // Show add site modal
        function showAddSiteModal() {
            document.getElementById('addSiteModal').style.display = 'flex';
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Add a new worker
        function addWorker() {
            const name = document.getElementById('workerName').value.trim();
            const role = document.getElementById('workerRole').value;
            const rate = parseInt(document.getElementById('workerRate').value);
            const bank = document.getElementById('workerBank').value.trim();
            const account = document.getElementById('workerAccount').value.trim();
            const phone = document.getElementById('workerPhone').value.trim();
            const site = document.getElementById('workerSite').value;
            
            if (!name) {
                showToast('Please enter a name for the worker', 'error');
                return;
            }
            
            if (!rate || rate <= 0) {
                showToast('Please enter a valid daily rate', 'error');
                return;
            }
            
            const id = name.toLowerCase().replace(/\s+/g, '-');
            
            // Check if worker already exists
            if (workers.find(w => w.id === id)) {
                showToast('A worker with this name already exists', 'error');
                return;
            }
            
            const newWorker = {
                id,
                name,
                role,
                rate,
                bank,
                account,
                phone,
                site,
                attendance: {}
            };
            
            workers.push(newWorker);
            saveWorkers();
            renderWorkers();
            updateStats();
            closeModal('addWorkerModal');
            
            // Reset form
            document.getElementById('workerName').value = '';
            document.getElementById('workerRate').value = '';
            document.getElementById('workerBank').value = '';
            document.getElementById('workerAccount').value = '';
            document.getElementById('workerPhone').value = '';
            
            showToast(`Worker ${name} added successfully`, 'success');
        }

        // Edit worker
        function editWorker(workerId) {
            const worker = workers.find(w => w.id === workerId);
            if (!worker) return;
            
            // For now, just show a simple edit option
            const newName = prompt(`Edit name for ${worker.name}:`, worker.name);
            if (newName && newName.trim() !== '') {
                worker.name = newName.trim();
                saveWorkers();
                renderWorkers();
                showToast(`Worker name updated to ${worker.name}`, 'success');
            }
        }

        // Add a new site
        function addSite() {
            const name = document.getElementById('siteName').value.trim();
            const code = document.getElementById('siteCode').value.trim().toUpperCase();
            
            if (!name) {
                showToast('Please enter a name for the site', 'error');
                return;
            }
            
            if (!code) {
                showToast('Please enter a code for the site', 'error');
                return;
            }
            
            // Check if site already exists
            if (sites.find(s => s.name === name)) {
                showToast('A site with this name already exists', 'error');
                return;
            }
            
            const newSite = {
                id: name.toLowerCase().replace(/\s+/g, '-'),
                name,
                code
            };
            
            sites.push(newSite);
            saveSites();
            updateSiteSelector();
            closeModal('addSiteModal');
            
            // Reset form
            document.getElementById('siteName').value = '';
            document.getElementById('siteCode').value = '';
            
            showToast(`Site ${name} added successfully`, 'success');
        }

        // Delete a worker
        function deleteWorker(workerId) {
            const worker = workers.find(w => w.id === workerId);
            if (!worker) return;
            
            if (confirm(`Are you sure you want to delete ${worker.name}?`)) {
                workers = workers.filter(w => w.id !== workerId);
                saveWorkers();
                renderWorkers();
                updateStats();
                showToast(`Worker ${worker.name} deleted`, 'success');
            }
        }

        // Clear all attendance for the current fortnight
        function clearAllAttendance() {
            if (!confirm('Are you sure you want to clear all attendance for the current fortnight?')) {
                return;
            }
            
            const fortnight = getSelectedFortnight();
            
            workers.forEach(worker => {
                fortnight.days.forEach(day => {
                    const dateKey = formatDateForStorage(day);
                    delete worker.attendance[dateKey];
                });
            });
            
            saveWorkers();
            renderWorkers();
            updateStats();
            showToast('All attendance cleared for the current fortnight', 'success');
        }

        // Render all users table
        function renderAllUsersTable() {
            const tableBody = document.getElementById('usersTableBody');
            tableBody.innerHTML = '';
            
            // Sort workers by role
            const sortedWorkers = sortWorkersByRole([...workers]);
            
            sortedWorkers.forEach(worker => {
                const daysWorked = calculateDaysWorked(worker);
                const totalPay = daysWorked * worker.rate;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${worker.name}</td>
                    <td>${worker.role}</td>
                    <td>R ${worker.rate}</td>
                    <td>${worker.site}</td>
                    <td>${worker.bank || 'Not specified'}</td>
                    <td>${worker.account || 'Not specified'}</td>
                    <td>${daysWorked}</td>
                    <td>R ${totalPay}</td>
                    <td>
                        <button class="action-btn" onclick="editWorker('${worker.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteWorker('${worker.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Render reports
        function renderReports() {
            const siteWorkers = workers.filter(worker => selectedSite === '' || worker.site === selectedSite);
            const totalWorkers = siteWorkers.length;
            
            // Calculate total days worked and payroll for the current fortnight
            let totalDaysWorked = 0;
            let totalPay = 0;
            
            siteWorkers.forEach(worker => {
                const daysWorked = calculateDaysWorked(worker);
                totalDaysWorked += daysWorked;
                totalPay += daysWorked * worker.rate;
            });
            
            // Calculate attendance rate
            const fortnight = getSelectedFortnight();
            const totalPossibleDays = totalWorkers * fortnight.days.length;
            const attendanceRate = totalPossibleDays > 0 ? Math.round((totalDaysWorked / totalPossibleDays) * 100) : 0;
            
            // Update report stats
            document.getElementById('reportTotalWorkers').textContent = totalWorkers;
            document.getElementById('reportAttendanceRate').textContent = `${attendanceRate}%`;
            document.getElementById('reportTotalPay').textContent = `R ${totalPay.toLocaleString()}`;
            document.getElementById('reportDaysInPeriod').textContent = fortnight.days.length;
            
            // Render report table
            const tableBody = document.getElementById('reportsTableBody');
            tableBody.innerHTML = '';
            
            // Sort workers by role
            const sortedWorkers = sortWorkersByRole([...siteWorkers]);
            
            sortedWorkers.forEach(worker => {
                const daysWorked = calculateDaysWorked(worker);
                const totalPay = daysWorked * worker.rate;
                const attendanceRate = Math.round((daysWorked / fortnight.days.length) * 100);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${worker.name}</td>
                    <td>${worker.role}</td>
                    <td>${daysWorked}</td>
                    <td>R ${totalPay}</td>
                    <td>${attendanceRate}%</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Export daily attendance as PDF
        function exportDailyAttendancePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const today = new Date();
            const todayFormatted = formatDate(today);
            
            // Add title
            doc.setFontSize(20);
            doc.text('Tonny Lays Construction - Daily Attendance', 20, 20);
            
            // Add date information
            doc.setFontSize(12);
            doc.text(`Date: ${todayFormatted}`, 20, 35);
            doc.text(`Site: ${selectedSite || 'All Sites'}`, 20, 45);
            doc.text(`Generated: ${new Date().toLocaleString()}`, 20, 55);
            
            // Prepare table data
            const siteWorkers = workers.filter(worker => selectedSite === '' || worker.site === selectedSite);
            const tableData = [];
            
            // Add header
            tableData.push(['Name', 'Role', 'Status', 'Time Marked']);
            
            // Add worker data
            let presentCount = 0;
            let absentCount = 0;
            let notMarkedCount = 0;
            
            // Sort workers by role
            const sortedWorkers = sortWorkersByRole([...siteWorkers]);
            
            sortedWorkers.forEach(worker => {
                const todayKey = formatDateForStorage(today);
                const attendanceStatus = worker.attendance[todayKey] || 'Not Marked';
                const timeMarked = worker.attendance[todayKey] ? new Date().toLocaleTimeString() : '-';
                
                tableData.push([
                    worker.name,
                    worker.role,
                    attendanceStatus,
                    timeMarked
                ]);
                
                if (attendanceStatus === 'present') presentCount++;
                else if (attendanceStatus === 'absent') absentCount++;
                else notMarkedCount++;
            });
            
            // Add summary
            doc.text(`Summary: Present: ${presentCount}, Absent: ${absentCount}, Not Marked: ${notMarkedCount}`, 20, 70);
            
            // Generate table
            doc.autoTable({
                startY: 75,
                head: [tableData[0]],
                body: tableData.slice(1),
                theme: 'grid',
                headStyles: { fillColor: [46, 139, 87] },
                styles: { fontSize: 10 },
                margin: { top: 75 }
            });
            
            // Save the PDF
            doc.save(`TonnyLays_Daily_Attendance_${todayFormatted.replace(/\//g, '-')}.pdf`);
            showToast('Daily attendance PDF generated successfully', 'success');
        }

        // Generate payroll report (PDF)
        function generatePayrollReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.text('Tonny Lays Construction - Payroll Report', 20, 20);
            
            // Add period information
            doc.setFontSize(12);
            const fortnight = getSelectedFortnight();
            doc.text(`Period: ${formatDate(fortnight.start)} - ${formatDate(fortnight.end)}`, 20, 35);
            doc.text(`Site: ${selectedSite || 'All Sites'}`, 20, 45);
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 55);
            
            // Prepare table data
            const siteWorkers = workers.filter(worker => selectedSite === '' || worker.site === selectedSite);
            const tableData = [];
            
            // Add header
            tableData.push(['Name', 'Role', 'Days', 'Rate', 'Total Pay', 'Bank', 'Account No.']);
            
            // Add worker data
            let totalPayroll = 0;
            
            // Sort workers by role
            const sortedWorkers = sortWorkersByRole([...siteWorkers]);
            
            sortedWorkers.forEach(worker => {
                const daysWorked = calculateDaysWorked(worker);
                const totalPay = daysWorked * worker.rate;
                totalPayroll += totalPay;
                
                tableData.push([
                    worker.name,
                    worker.role,
                    daysWorked.toString(),
                    `R ${worker.rate}`,
                    `R ${totalPay}`,
                    worker.bank || 'Not specified',
                    worker.account || 'Not specified'
                ]);
            });
            
            // Add total row
            tableData.push(['', '', '', '', `R ${totalPayroll}`, '', '']);
            
            // Generate table
            doc.autoTable({
                startY: 65,
                head: [tableData[0]],
                body: tableData.slice(1),
                theme: 'grid',
                headStyles: { fillColor: [46, 139, 87] },
                styles: { fontSize: 9 },
                margin: { top: 65 }
            });
            
            // Save the PDF
            doc.save(`TonnyLays_Payroll_${formatDate(fortnight.start).replace(/\//g, '-')}_${formatDate(fortnight.end).replace(/\//g, '-')}.pdf`);
            showToast('Payroll report generated successfully', 'success');
        }

        // Export to Excel with bank details
        function exportToExcel() {
            const siteWorkers = workers.filter(worker => selectedSite === '' || worker.site === selectedSite);
            const workbook = XLSX.utils.book_new();
            
            // Prepare data
            const data = [['Name', 'Role', 'Rate', 'Site', 'Bank', 'Account No.', 'Phone', 'Days Worked', 'Total Pay']];
            
            // Sort workers by role
            const sortedWorkers = sortWorkersByRole([...siteWorkers]);
            
            sortedWorkers.forEach(worker => {
                const daysWorked = calculateDaysWorked(worker);
                const totalPay = daysWorked * worker.rate;
                
                data.push([
                    worker.name,
                    worker.role,
                    worker.rate,
                    worker.site,
                    worker.bank || 'Not specified',
                    worker.account || 'Not specified',
                    worker.phone || 'Not provided',
                    daysWorked,
                    totalPay
                ]);
            });
            
            // Create worksheet
            const worksheet = XLSX.utils.aoa_to_sheet(data);
            
            // Add worksheet to workbook
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Payroll');
            
            // Generate Excel file and trigger download
            const fortnight = getSelectedFortnight();
            XLSX.writeFile(workbook, `TonnyLays_Payroll_${formatDate(fortnight.start).replace(/\//g, '-')}_${formatDate(fortnight.end).replace(/\//g, '-')}.xlsx`);
            showToast('Excel file exported successfully', 'success');
        }

        // Sync data to cloud (placeholder)
        function syncToCloud() {
            showToast('Cloud sync is currently unavailable. Please use PDF and Excel exports for backup.', 'error');
        }

        // Show sync status
        function showSyncStatus(status, message) {
            const syncStatus = document.getElementById('syncStatus');
            syncStatus.className = `sync-status ${status}`;
            syncStatus.querySelector('span').textContent = message;
        }

        // Backup all data
        function backupData() {
            exportToExcel();
            exportDailyAttendancePDF();
            showToast('All data backed up successfully', 'success');
        }

        // Save data locally
        function saveData() {
            saveWorkers();
            showToast('Data saved locally', 'success');
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastIcon = toast.querySelector('.toast-icon i');
            const toastTitle = toast.querySelector('.toast-title');
            const toastMessage = toast.querySelector('.toast-message');
            
            // Set icon and title based on type
            if (type === 'success') {
                toastIcon.className = 'fas fa-check';
                toastTitle.textContent = 'Success';
                toast.style.borderLeftColor = 'var(--success)';
                toast.querySelector('.toast-icon').style.background = 'var(--success)';
            } else if (type === 'error') {
                toastIcon.className = 'fas fa-exclamation-triangle';
                toastTitle.textContent = 'Error';
                toast.style.borderLeftColor = 'var(--danger)';
                toast.querySelector('.toast-icon').style.background = 'var(--danger)';
            } else {
                toastIcon.className = 'fas fa-info-circle';
                toastTitle.textContent = 'Info';
                toast.style.borderLeftColor = 'var(--accent)';
                toast.querySelector('.toast-icon').style.background = 'var(--accent)';
            }
            
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>